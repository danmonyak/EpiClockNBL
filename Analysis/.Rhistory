geom_boxplot() +
labs(title = "Percent by Type", y = "Percent") +
theme_minimal()
ggplot(data, aes(x = operator, y = percent, fill = operator)) +
geom_boxplot() +
labs(title = "Percent by Operator", y = "Percent") +
theme_minimal()
# Histogram for Percent
ggplot(data, aes(x = percent)) +
geom_histogram(binwidth = 5, fill = "skyblue", color = "black") +
labs(title = "Distribution of Percent", y = "Percent")
# 1. Fisher's Exact Test for number of punctures between trial types
fisher_table <- with(data, table(type, NoPuncture))
fisher_test <- fisher.test(fisher_table)
# 2. Shapiro-Wilk test for normality by trial type
shapiro_results <- data %>%
group_by(type) %>%
summarise(
shapiro_stat = shapiro.test(percent[!is.na(percent)])$statistic,
shapiro_p = shapiro.test(percent[!is.na(percent)])$p.value
)
# 3. Levene's test for equality of variances
levene_test <- leveneTest(percent ~ type, data = data)
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# Calculate summary statistics by type
type_summary <- data %>%
group_by(type) %>%
summarise(
n = n(),
success_rate = mean(NoPuncture == 1, na.rm = TRUE),
mean_depth = mean(percent, na.rm = TRUE),
sd_depth = sd(percent, na.rm = TRUE),
n_punctures = sum(NoPuncture == 0, na.rm = TRUE),
n_no_punctures = sum(NoPuncture == 1, na.rm = TRUE)
)
# Print results
cat("\nSummary Statistics by Trial Type:\n")
print(type_summary)
cat("\nFisher's Exact Test for Punctures between Trial Types:\n")
print(fisher_test)
cat("\nShapiro-Wilk Test for Normality by Trial Type:\n")
print(shapiro_results)
cat("\nLevene's Test for Equality of Variances:\n")
print(levene_test)
cat("\nGLMM Results:\n")
print(summary(glmm_model))
# Visualization of depth distributions by type
p1 <- ggplot(data, aes(x = type, y = percent)) +
geom_boxplot(fill = "lightblue") +
geom_jitter(width = 0.2, alpha = 0.5) +
theme_minimal() +
labs(title = "Depth Distribution by Trial Type",
x = "Trial Type",
y = "Depth Percentage")
# Visualization of puncture rates by type
p2 <- ggplot(type_summary, aes(x = type, y = success_rate)) +
geom_bar(stat = "identity", fill = "steelblue") +
theme_minimal() +
labs(title = "Success Rate (No Puncture) by Trial Type",
x = "Trial Type",
y = "Success Rate") +
scale_y_continuous(labels = scales::percent)
print(p1)
print(p2)
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# Model Diagnostics
# DHARMa Residuals
simulationOutput <- simulateResiduals(fittedModel = glmm_model)
plot(simulationOutput)  # Check for patterns
# Check for Overdispersion
overdispersion_test <- sum(residuals(glmm_model, type = "deviance")^2) / df.residual(glmm_model)
cat("\nOverdispersion Test Statistic:", overdispersion_test, "\n") # Values >> 1 suggest overdispersion
# Random Effects Variance
print(VarCorr(glmm_model))
# Check for Singularities (Random effect variance close to zero)
print(isSingular(glmm_model))
# Model Comparison (AIC)
model_with_interaction <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_interaction)
model_with_random_slope <- glmer(NoPuncture ~ operator + type + (operator | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_random_slope)
# Parameter Summaries
cat("\nGLMM Results:\n")
print(summary(glmm_model))
print(confint(glmm_model))
# ANOVA and Chi-squared test for Type Effect
model_no_type <- glmer(NoPuncture ~ operator + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
# Compare the full model to the model without type
anova_result <- anova(glmm_model, model_no_type)
print(anova_result)
# Alternative, using a chi-squared test
# Extract the relevant components from the model summary
chi_sq_stat <- anova_result$`Chisq`[2] # Chi-squared statistic for type
df <- anova_result$Df[2] # Degrees of freedom for type
p_value <- anova_result$`Pr(>Chisq)`[2] # P-value for type
cat("Chi-squared test for type effect:\n")
cat("Chi-squared statistic:", chi_sq_stat, "\n")
cat("Degrees of freedom:", df, "\n")
cat("P-value:", p_value, "\n")
# Estimated Marginal Means (emmeans) and Post-hoc Comparisons (for type)
emm_model <- emmeans(glmm_model, ~ type)
# Pairwise comparisons
pairs(emm_model, adjust = "tukey") # Adjust for multiple comparisons
# Intraclass Correlation Coefficient (ICC)
icc <- icc(glmm_model)
if(!require(performance)){install.packages("performance")} # Check and install performance
library(performance) # Load performance
knitr::opts_chunk$set(echo = TRUE)
# Load necessary libraries
library(tidyverse)  # For data manipulation and visualization
library(lme4)       # For generalized linear mixed models
library(lmerTest)   # For p-values in mixed models
library(ggplot2)    # For custom visualizations
library(dplyr)
library(tidyr)
library(car)  # for Levene's test
library(stats) # for Shapiro's test
library(DHARMa)
library(emmeans)
library(performance)
# Read input data
data <- read.csv("data.csv")
# Inspect the first few rows of the dataset
head(data)  # Preview of the first few rows
# Check column names to ensure correct references
cat("Column names:", colnames(data))
# Convert relevant columns to factors
data$type <- as.factor(data$type)  # Check for correct column name
data$operator <- as.factor(data$operator)
data$cornea <- as.factor(data$cornea)
# Summary statistics of the dataset
summary(data)
str(data)  # Structure of the dataset
# Convert dependent variable to a factor
# Assuming 'Puncture' is the dependent variable
# Make sure "Puncture" is coded as 0 (No Puncture) and 1 (Puncture)
data$NoPuncture <- as.factor(data$NoPuncture)
# Exploratory Data Analysis
# Plot distribution of punctures by type and operator
ggplot(data, aes(x = type, fill = NoPuncture)) +
geom_bar(position = "fill") +
labs(title = "Proportion of Punctures by Type", y = "Proportion") +
theme_minimal()
ggplot(data, aes(x = operator, fill = NoPuncture)) +
geom_bar(position = "fill") +
labs(title = "Proportion of Punctures by Operator", y = "Proportion") +
theme_minimal()
# Additional Exploratory Data Analysis
# Descriptive statistics for Percent
cat("Descriptive Statistics for Percent:\n")
summary_stats <- summarize(data,
Mean = mean(percent, na.rm = TRUE),
Std_Dev = sd(percent, na.rm = TRUE),
Median = median(percent, na.rm = TRUE),
Min = min(percent, na.rm = TRUE),
Max = max(percent, na.rm = TRUE)
)
print(summary_stats)
# Load knitr for kable table formatting
library(knitr)
# Frequency tables with kable
cat("\nFrequency of Type:\n")
kable(table(data$type))
cat("\nFrequency of Operator:\n")
kable(table(data$operator))
cat("\nFrequency of Cornea:\n")
kable(table(data$cornea))
# Boxplots for Percent by Type and Operator
ggplot(data, aes(x = type, y = percent, fill = type)) +
geom_boxplot() +
labs(title = "Percent by Type", y = "Percent") +
theme_minimal()
ggplot(data, aes(x = operator, y = percent, fill = operator)) +
geom_boxplot() +
labs(title = "Percent by Operator", y = "Percent") +
theme_minimal()
# Histogram for Percent
ggplot(data, aes(x = percent)) +
geom_histogram(binwidth = 5, fill = "skyblue", color = "black") +
labs(title = "Distribution of Percent", y = "Percent")
# 1. Fisher's Exact Test for number of punctures between trial types
fisher_table <- with(data, table(type, NoPuncture))
fisher_test <- fisher.test(fisher_table)
# 2. Shapiro-Wilk test for normality by trial type
shapiro_results <- data %>%
group_by(type) %>%
summarise(
shapiro_stat = shapiro.test(percent[!is.na(percent)])$statistic,
shapiro_p = shapiro.test(percent[!is.na(percent)])$p.value
)
# 3. Levene's test for equality of variances
levene_test <- leveneTest(percent ~ type, data = data)
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# Calculate summary statistics by type
type_summary <- data %>%
group_by(type) %>%
summarise(
n = n(),
success_rate = mean(NoPuncture == 1, na.rm = TRUE),
mean_depth = mean(percent, na.rm = TRUE),
sd_depth = sd(percent, na.rm = TRUE),
n_punctures = sum(NoPuncture == 0, na.rm = TRUE),
n_no_punctures = sum(NoPuncture == 1, na.rm = TRUE)
)
# Print results
cat("\nSummary Statistics by Trial Type:\n")
print(type_summary)
cat("\nFisher's Exact Test for Punctures between Trial Types:\n")
print(fisher_test)
cat("\nShapiro-Wilk Test for Normality by Trial Type:\n")
print(shapiro_results)
cat("\nLevene's Test for Equality of Variances:\n")
print(levene_test)
cat("\nGLMM Results:\n")
print(summary(glmm_model))
# Visualization of depth distributions by type
p1 <- ggplot(data, aes(x = type, y = percent)) +
geom_boxplot(fill = "lightblue") +
geom_jitter(width = 0.2, alpha = 0.5) +
theme_minimal() +
labs(title = "Depth Distribution by Trial Type",
x = "Trial Type",
y = "Depth Percentage")
# Visualization of puncture rates by type
p2 <- ggplot(type_summary, aes(x = type, y = success_rate)) +
geom_bar(stat = "identity", fill = "steelblue") +
theme_minimal() +
labs(title = "Success Rate (No Puncture) by Trial Type",
x = "Trial Type",
y = "Success Rate") +
scale_y_continuous(labels = scales::percent)
print(p1)
print(p2)
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# Model Diagnostics
# DHARMa Residuals
simulationOutput <- simulateResiduals(fittedModel = glmm_model)
plot(simulationOutput)  # Check for patterns
# Check for Overdispersion
overdispersion_test <- sum(residuals(glmm_model, type = "deviance")^2) / df.residual(glmm_model)
cat("\nOverdispersion Test Statistic:", overdispersion_test, "\n") # Values >> 1 suggest overdispersion
# Random Effects Variance
print(VarCorr(glmm_model))
# Check for Singularities (Random effect variance close to zero)
print(isSingular(glmm_model))
# Model Comparison (AIC)
model_with_interaction <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_interaction)
model_with_random_slope <- glmer(NoPuncture ~ operator + type + (operator | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_random_slope)
# Parameter Summaries
cat("\nGLMM Results:\n")
print(summary(glmm_model))
print(confint(glmm_model))
# ANOVA and Chi-squared test for Type Effect
model_no_type <- glmer(NoPuncture ~ operator + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
# Compare the full model to the model without type
anova_result <- anova(glmm_model, model_no_type)
print(anova_result)
# Alternative, using a chi-squared test
# Extract the relevant components from the model summary
chi_sq_stat <- anova_result$`Chisq`[2] # Chi-squared statistic for type
df <- anova_result$Df[2] # Degrees of freedom for type
p_value <- anova_result$`Pr(>Chisq)`[2] # P-value for type
cat("Chi-squared test for type effect:\n")
cat("Chi-squared statistic:", chi_sq_stat, "\n")
cat("Degrees of freedom:", df, "\n")
cat("P-value:", p_value, "\n")
# Estimated Marginal Means (emmeans) and Post-hoc Comparisons (for type)
emm_model <- emmeans(glmm_model, ~ type)
# Pairwise comparisons
pairs(emm_model, adjust = "tukey") # Adjust for multiple comparisons
# Intraclass Correlation Coefficient (ICC)
icc <- icc(glmm_model)
print(icc)
# Key Findings Summary (for client)
cat("\nKey Findings Summary:\n")
cat("1. The overall success rate (no puncture) was ... (calculate from data).\n")
cat("2. The effect of surgery type (DALK vs. microscope only) was statistically significant/not significant (from ANOVA/Chi-squared test, report p-value). \n") # Replace with actual result
cat("3. ... (Summarize the emmeans post-hoc comparisons - which type had higher success rates?).\n")
cat("4. There was/was not evidence of overdispersion (report overdispersion test statistic). \n") # Replace with actual result
cat("5. ... (Summarize other important findings, e.g. operator effects if significant, or the ICC to indicate the proportion of variance explained by cornea). \n")
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# Model Diagnostics
# DHARMa Residuals
simulationOutput <- simulateResiduals(fittedModel = glmm_model)
plot(simulationOutput)  # Check for patterns
# Check for Overdispersion
overdispersion_test <- sum(residuals(glmm_model, type = "deviance")^2) / df.residual(glmm_model)
cat("\nOverdispersion Test Statistic:", overdispersion_test, "\n") # Values >> 1 suggest overdispersion
# Random Effects Variance
print(VarCorr(glmm_model))
# Check for Singularities (Random effect variance close to zero)
print(isSingular(glmm_model))
# Model Comparison (AIC)
model_with_interaction <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_interaction)
model_with_random_slope <- glmer(NoPuncture ~ operator + type + (operator | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_random_slope)
# Parameter Summaries
cat("\nGLMM Results:\n")
print(summary(glmm_model))
print(confint(glmm_model))
# ANOVA and Chi-squared test for Type Effect
model_no_type <- glmer(NoPuncture ~ operator + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
# Compare the full model to the model without type
anova_result <- anova(glmm_model, model_no_type)
print(anova_result)
# Alternative, using a chi-squared test
# Extract the relevant components from the model summary
chi_sq_stat <- anova_result$`Chisq`[2] # Chi-squared statistic for type
df <- anova_result$Df[2] # Degrees of freedom for type
p_value <- anova_result$`Pr(>Chisq)`[2] # P-value for type
cat("Chi-squared test for type effect:\n")
cat("Chi-squared statistic:", chi_sq_stat, "\n")
cat("Degrees of freedom:", df, "\n")
cat("P-value:", p_value, "\n")
# Estimated Marginal Means (emmeans) and Post-hoc Comparisons (for type)
emm_model <- emmeans(glmm_model, ~ type)
# Pairwise comparisons
pairs(emm_model, adjust = "tukey") # Adjust for multiple comparisons
# Intraclass Correlation Coefficient (ICC)
icc <- icc(glmm_model)
print(icc)
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# Model Diagnostics
# DHARMa Residuals
simulationOutput <- simulateResiduals(fittedModel = glmm_model)
plot(simulationOutput)  # Check for patterns
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# Model Diagnostics
# DHARMa Residuals
simulationOutput <- simulateResiduals(fittedModel = glmm_model)
plot(simulationOutput)  # Check for patterns
# Check for Overdispersion
overdispersion_test <- sum(residuals(glmm_model, type = "deviance")^2) / df.residual(glmm_model)
cat("\nOverdispersion Test Statistic:", overdispersion_test, "\n") # Values >> 1 suggest overdispersion
glmm_model <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
# Model Diagnostics
# DHARMa Residuals
simulationOutput <- simulateResiduals(fittedModel = glmm_model)
plot(simulationOutput)  # Check for patterns
# Check for Overdispersion
overdispersion_test <- sum(residuals(glmm_model, type = "deviance")^2) / df.residual(glmm_model)
cat("\nOverdispersion Test Statistic:", overdispersion_test, "\n") # Values >> 1 suggest overdispersion
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# Model Diagnostics
# DHARMa Residuals
simulationOutput <- simulateResiduals(fittedModel = glmm_model)
plot(simulationOutput)  # Check for patterns
# Check for Overdispersion
overdispersion_test <- sum(residuals(glmm_model, type = "deviance")^2) / df.residual(glmm_model)
cat("\nOverdispersion Test Statistic:", overdispersion_test, "\n") # Values >> 1 suggest overdispersion
# Random Effects Variance
print(VarCorr(glmm_model))
# Check for Singularities (Random effect variance close to zero)
print(isSingular(glmm_model))
# Model Comparison (AIC)
model_with_interaction <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_interaction)
print(summary(glmm_model))
print(confint(glmm_model))
# ANOVA and Chi-squared test for Type Effect
model_no_type <- glmer(NoPuncture ~ operator + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
# Compare the full model to the model without type
anova_result <- anova(glmm_model, model_no_type)
print(anova_result)
# ANOVA and Chi-squared test for Type Effect
model_no_type <- glmer(NoPuncture ~ operator + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
# Compare the full model to the model without type
anova_result <- anova(glmm_model, model_no_type)
print(anova_result)
model_with_random_slope <- glmer(NoPuncture ~ operator + type + (operator | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_random_slope)
model_with_random_operator_slope <- glmer(NoPuncture ~ operator + type + (operator | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_random_operator_slope)
AIC(glmm_model, model_with_random_operator_slope)
# Alternative, using a chi-squared test
# Extract the relevant components from the model summary
chi_sq_stat <- anova_result$`Chisq`[2] # Chi-squared statistic for type
df <- anova_result$Df[2] # Degrees of freedom for type
p_value <- anova_result$`Pr(>Chisq)`[2] # P-value for type
cat("Chi-squared test for type effect:\n")
cat("Chi-squared statistic:", chi_sq_stat, "\n")
cat("Degrees of freedom:", df, "\n")
cat("P-value:", p_value, "\n")
# Estimated Marginal Means (emmeans) and Post-hoc Comparisons (for type)
emm_model <- emmeans(glmm_model, ~ type)
# Pairwise comparisons
pairs(emm_model, adjust = "tukey") # Adjust for multiple comparisons
# Intraclass Correlation Coefficient (ICC)
icc <- icc(glmm_model)
print(icc)
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# glmm_model <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
# Model Diagnostics
# DHARMa Residuals
simulationOutput <- simulateResiduals(fittedModel = glmm_model)
plot(simulationOutput)  # Check for patterns
# Check for Overdispersion
overdispersion_test <- sum(residuals(glmm_model, type = "deviance")^2) / df.residual(glmm_model)
cat("\nOverdispersion Test Statistic:", overdispersion_test, "\n") # Values >> 1 suggest overdispersion
# Random Effects Variance
print(VarCorr(glmm_model))
# Check for Singularities (Random effect variance close to zero)
print(isSingular(glmm_model))
# Model Comparison (AIC)
model_with_interaction <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_interaction)
model_with_random_operator_slope <- glmer(NoPuncture ~ operator + type +
(operator | cornea),
family = binomial,
data = data,
control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_random_operator_slope)
# Parameter Summaries
cat("\nGLMM Results:\n")
print(summary(glmm_model))
print(confint(glmm_model))
# Intraclass Correlation Coefficient (ICC)
icc <- icc(glmm_model)
print(icc)
# Model Comparison (AIC)
model_with_interaction <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_interaction)
# Model Comparison (AIC)
model_with_interaction <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_interaction)
AIC(glmm_model, model_with_interaction)
# Fit GLMM
glmm_model <- glmer(
NoPuncture ~ operator + type + (1|cornea),
family = binomial(link = "logit"),
data = data,
control = glmerControl(optimizer = "bobyqa")
)
# glmm_model <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
# Model Diagnostics
# DHARMa Residuals
simulationOutput <- simulateResiduals(fittedModel = glmm_model)
plot(simulationOutput)  # Check for patterns
# Check for Overdispersion
overdispersion_test <- sum(residuals(glmm_model, type = "deviance")^2) / df.residual(glmm_model)
cat("\nOverdispersion Test Statistic:", overdispersion_test, "\n") # Values >> 1 suggest overdispersion
# Random Effects Variance
print(VarCorr(glmm_model))
# Check for Singularities (Random effect variance close to zero)
print(isSingular(glmm_model))
# Model Comparison (AIC)
model_with_interaction <- glmer(NoPuncture ~ operator * type + (1 | cornea), family = binomial, data = data, control = glmerControl(optimizer = "bobyqa"))
AIC(glmm_model, model_with_interaction)
# Parameter Summaries
cat("\nGLMM Results:\n")
print(summary(glmm_model))
print(confint(glmm_model))
# Intraclass Correlation Coefficient (ICC)
icc <- icc(glmm_model)
print(icc)
